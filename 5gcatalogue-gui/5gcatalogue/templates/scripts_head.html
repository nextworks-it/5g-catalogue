<!--/*
* Copyright 2018 Nextworks s.r.l.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/-->
<!-- Bootstrap -->
<link href="/gentelella/vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Font Awesome -->
<link href="/gentelella/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
<!-- NProgress -->
<link href="/gentelella/vendors/nprogress/nprogress.css" rel="stylesheet">
<!-- bootstrap-daterangepicker -->
<link href="/gentelella/vendors/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">

<!-- Custom Theme Style -->
<link href="/gentelella/build/css/custom.min.css" rel="stylesheet">
<link href="/5gcatalogue/css/5gcatalogue.min.css" rel="stylesheet">

<!-- jQuery-3.2.1 -->
<script src="/5gcatalogue/plugin/jquery-3.2.1.min.js"></script>

<!-- Cytoscape-3.1.0 -->
<meta name="viewport" content="user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, minimal-ui">
<script src="/5gcatalogue/plugin/cytoscape.js-3.1.0/cytoscape.min.js"></script>

<!-- 5G APP & SERVICE CATALOGUE Scripts -->
<script src="/5gcatalogue/plugin/rest_api.js"></script>
<script src="/5gcatalogue/plugin/utils.js"></script>
<script src="/5gcatalogue/plugin/admin_utils.js"></script>
<script src="/5gcatalogue/plugin/nsd_utils.js"></script>
<script src="/5gcatalogue/plugin/pnfd_utils.js"></script>
<script src="/5gcatalogue/plugin/vnfd_utils.js"></script>
<script src="/5gcatalogue/plugin/login_utils.js"></script>

<!-- Js-Yaml -->
<script src="/5gcatalogue/plugin/js-yaml/dist/js-yaml.min.js"></script>

<!-- keycloak-js -->
<script src="/5gcatalogue/plugin/keycloak-js-bower/dist/keycloak.js"></script>
<script>
    if (kcEnabled) {
        var keycloak = Keycloak({
            url: 'http://10.20.8.21:8080/auth/', //10.20.8.21, localhost
            realm: '5gcity', //5gcity, osm
            clientId: '5gcatalogue' //5gcatalogue, catalog2
        });
        var loadData = function () {
            
            if (keycloak.idToken) {
                //var realm = keycloak.tokenParsed.realm;  
                var service_role = keycloak.tokenParsed.service_role;  
                var username = keycloak.tokenParsed.preferred_username;
                var project_name = keycloak.tokenParsed.project_name;
                //var projects = keycloak.tokenParsed.groups;

                /*var projectsDropDown = document.getElementById("userProjects");
                for (var i = 0 ; i < projects.length; i++) {
                    console.log("Project: "  + projects[i]);
                    projectsDropDown.innerHTML += '<li><a onclick=selectProject("' + projects[i] + '"); href="#">' + projects[i] + '</a></li>';
                }*/
                
                document.getElementById('userName').innerHTML = '<b>' + username + '</b>';
                document.getElementById('userNameBar').innerHTML = '<b>' + username + '</b>';
                
                //console.log("idToken: " + keycloak.idToken);
                //console.log("Token: " +  keycloak.token);
                //console.log("Realm: " + realm);
                console.log("Project: " + project_name);
                console.log("Service Role: " + service_role);
                setCookie("TOKEN", keycloak.token, 1);
                setCookie("ROLE", service_role, 1);
                
                /*var projCookie = getCookie("PROJECT");
                console.log("Current project: " + projCookie);
                if(service_role.indexOf("ADMIN") >= 0) {
                    if (projCookie == "") {
                        setCookie("PROJECT", "/Admins", 1);
                    }
                } else {
                    if (projCookie == "") {
                        setCookie("PROJECT", projects[0], 1);
                    }
                }
                document.getElementById('project').innerHTML = '<b>' + getCookie("PROJECT") + '</b>';
                document.getElementById('projectBar').innerHTML = '<b>' + getCookie("PROJECT") + '</b>';*/

                //document.getElementById('profileType').innerHTML = 'IDToken';
                //document.getElementById('email').innerHTML = keycloak.idTokenParsed.email;
                //document.getElementById('name').innerHTML = keycloak.idTokenParsed.name;
                //document.getElementById('givenName').innerHTML = keycloak.idTokenParsed.given_name;
                //document.getElementById('familyName').innerHTML = keycloak.idTokenParsed.family_name;
            } else {
                window.location.replace("/5gcatalogue/401.html");
            }
        };
        var loadFailure = function () {
            showResultMessage(false, "Failed to load user data");
        };
        var reloadData = function () {
            keycloak.updateToken(20)
                    .success(loadData)
                    .error(function() {
                        showResultMessage(false, "Failed to load user data");
                    });
        }
        keycloak.init({onLoad: 'login-required', checkLoginIframe: false}).success(reloadData);
    }
</script>
<script>
    getAllProjects('project', 'projectBar', fillProjectsData);
</script>